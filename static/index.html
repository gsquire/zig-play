<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Zig Playground</title>
        <link rel="shortcut icon" type="image/x-icon" href="/logo.ico" />
        <link href="/style.css" rel="stylesheet" type="text/css"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
          async function runCode() {
            const element = document.getElementById('code');
            const stdout = document.getElementById('stdout');
            if (element && stdout) {
              const code = element.value;
              const res = await fetch('/server/run/', {
                method: 'POST',
                headers: {
                  'Content-Type': 'text/plain'
                },
                body: code,
                redirect: 'follow'
              }).then(res => {
                if (res.ok) {
                  return res.text()
                } else if (res.status === 429) {
                  // Too many requests
                  return 'Too many requests. Please wait a minute then try again.';
                } else {
                  // Probably a compilation error
                  return res.text().then(t => 'An error occurred:\n' + t);
                }
              })
                .catch(_ => "Could not connect to server");
              stdout.innerHTML = res.split("\n").map(line => `<span style="display: block">${line}</span>`).reduce((a,b) => a + b, "");
            }
          }
        </script>
    </head>
    <body>
      <main>
        <h1>Zig Playground</h1>
        <p>Source:</p>
        <textarea id="code" name="code" rows="5" required="" placeholder="const std = ..." spellcheck="false">
const std = @import("std");

pub fn main() void {
  std.debug.print("Hello, {}!", .{"world"});
}
</textarea>
        <button type="submit" onclick="runCode()">Compile</button>
        <div id="stdout"></div>
      </main>
    </body>
</html>
